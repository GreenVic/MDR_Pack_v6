# Пример работы DMA с АЦП в режиме пинг-понг.

АЦП1 измеряет данные с канала подстроечного резистора на отладочной плате. DMA в режиме пинг-понг сохраняет данные с АЦП в два массива по очереди. Пока DMA работает по основной структуре рассчитывается среднее значение сигнала от АЦП по данным полученныи при цикле DMA от альтерной структуры. Когда работает альтернативный канал - рассчет идет по данным от основной структуры. Таким образом DMA работает безостановочно, переключая исполнение между основной и альтернативной структурами, которым в прерывании необходимо лишь восстановить контрольное слово.

Усреднение происходит из 1024 значений, столько же передач в одном цикле DMA. Чтобы успеть выполнить расчет и вывести данные на LCD экран скорость работы АЦП выбрана очень медленная. Цикл DMA и собственно экран обновляются раз в секунду. На экран выводятся два значения - усредненное значение сигнала от обоих массивов данных. Третьей цифрой выводится индекс от какой стурктуры произошло обновление данных - 1 от основной, 2 от альтернативной.

По кнопке UP (Key1) режим пинг понг останавливается - т.е. перестают переинициализироваться управляющие структуры. На экран выводится собщение об остановке работы (для 1986ВК234 это число FFFF).
По кнопке Right (Key2) работа DMA возобновляется. АЦП на время паузы не останавливается и генерит запросы к DMA. Но исполнение не зависает в обработчике DMA, что говорит что функция MDR_DMA_StopChannel отработала правильно.

Подкручивая подстроечный резистор на плате видно, что значение АЦП меняется. Для этого джампер на АЦП1 должен быть подключен в положение Trim.
В 1901ВЦ1 нет подстроечного резистора, для изменения сигнала достаточно воткнуть провод в BNC разъем, потрогать пальцем и прочее - изменения сигнала будут заметны.

В 1986ВЕ3Т 2-й ревизии запросы от АЦП к DMA не поступают, пример не работает! Ошибка errata - 003. В 3-й ревизии работает!

В 1986ВЕ1Т 4-й ревизии запросы от АЦП к DMA не поступают, пример не работает! Ошибка errata - 003. В 6-й ревизии работает! Для работы подстроечного резистора необходимо джампер пина PD9 выставить на R14, он находится между резистором и чипом..